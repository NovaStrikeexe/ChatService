@page "/real-time"
@inject MessageService MessageService

<h3>Real-Time Messages</h3>

<ul>
    @foreach (var msg in messages)
    {
        <li>@msg.Date: @msg.Content</li>
    }
</ul>

@code {
    private List<Message> messages = [];

    protected override async Task OnInitializedAsync()
    {
        MessageService.OnMessageReceived += HandleMessageReceived;
        await MessageService.StartWebSocket();
    }

    private void HandleMessageReceived(Message message)
    {
        InvokeAsync(() =>
        {
            messages.Add(message);
            StateHasChanged();
        });
    }
}