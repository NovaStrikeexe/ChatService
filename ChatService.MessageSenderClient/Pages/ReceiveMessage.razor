@page "/receive-message"
@using ChatService.MessageSenderClient.Shared.Models
@using Microsoft.AspNetCore.SignalR.Client

<h3>Messages</h3>

@foreach (var message in _messages)
{
    <p>@message.Id @message.Content @message.Date</p>
}

@code {
    private readonly List<MsgDto> _messages = [];
    private HubConnection? _hubConnection;

    protected override async Task OnInitializedAsync()
    {
        _hubConnection = new HubConnectionBuilder()
            .WithUrl("http://localhost:5150/chathub")
            .Build();

        _hubConnection.On<MsgDto>("ReceiveMessage", (msgDto) =>
        {
            _messages.Add(msgDto);
            InvokeAsync(StateHasChanged);
        });

        await _hubConnection.StartAsync();
    }
}