# Chat Service

## О проекте

Chat Service - это система обмена сообщениями, реализованная с использованием ASP.NET Core и SignalR. Проект включает несколько компонентов:

- **ChatService**: Основной серверный компонент, обеспечивающий обработку сообщений и взаимодействие через SignalR.
- **ChatService.MessageSenderClient**: Клиентское приложение для отправки сообщений.
- **ChatService.Tests**: Модульные тесты для серверной части и SignalR сервиса.
- **ChatService.Utils**: Утилиты для запуска проекта с помощью Docker Compose.

## Структура проекта

### `ChatService`

Основной проект сервиса, включающий:

- **Controllers**: Контроллеры API, например, `MessagesController`.
- **Models**: Модели данных, такие как `Msg` и `MsgDto`.
- **Services**: Реализация сервисов, включая `SignalRService`.
- **Data**: Репозитории и контексты для работы с базой данных.

### `ChatService.MessageSenderClient`

Клиентское приложение для отправки сообщений, использующее SignalR для взаимодействия с сервером.

### `ChatService.Tests`

Содержит модульные тесты для проверки функциональности сервиса и SignalR взаимодействия. Использует Moq для создания заглушек и проверки методов.

### `ChatService.Utils`
Вот обновленный раздел о запуске сервиса с учетом использования .NET 8:

## Запуск сервиса

Для запуска проекта ChatService и связанных компонентов, используйте Docker Compose. Убедитесь, что Docker и Docker Compose установлены на вашем компьютере.

### Запуск через Docker Compose

1. Перейдите в директорию `ChatService.Utils`, где расположен файл `docker-compose.yml`.

2. Запустите команду:

    ```bash
    docker-compose up
    ```

    Эта команда создаст и запустит все необходимые контейнеры для сервисов и базы данных, основываясь на настройках в `docker-compose.yml` и `.env`.

### Запуск с использованием .NET 8

Если вы хотите запустить проект локально, не используя Docker, вы можете сделать это с помощью .NET 8.

1. Убедитесь, что у вас установлена [.NET 8 SDK](https://dotnet.microsoft.com/download).

2. Перейдите в директорию `ChatService`:

    ```bash
    cd ChatService
    ```

3. Выполните команду для восстановления зависимостей:

    ```bash
    dotnet restore
    ```

4. Запустите приложение:

    ```bash
    dotnet run
    ```

    Сервис будет запущен на порту, указанном в `appsettings.json`, по умолчанию это `5019` (или другой порт, если вы изменили конфигурацию).

5. Для запуска клиентского приложения перейдите в директорию `ChatService.MessageSenderClient` и выполните:

    ```bash
    dotnet run
    ```

    Клиентское приложение будет запущено на порту, указанном в `.env` файле, по умолчанию это `5068` (или другой порт, если вы изменили конфигурацию).

### Проверка

- Откройте браузер и перейдите по адресу `http://localhost:5019` для доступа к сервису ChatService.
- Для клиентского приложения откройте `http://localhost:5068`.

В случае необходимости вы можете изменить порты и другие параметры в `.env` файле и в `appsettings.json` для адаптации к вашим требованиям.

## Конфигурация через `.env`

Файл `.env` используется для настройки переменных окружения для различных сервисов и базы данных. Поместите файл `.env` в директорию `ChatService.Utils` с содержимым:

```dotenv
# Порты для сервисов
CHAT_SERVICE_PORT=5019
CLIENT_PORT=5068
DB_PORT=5432

# Параметры подключения к базе данных
POSTGRES_DB=chatservice
POSTGRES_USER=user
POSTGRES_PASSWORD=password
```

- **CHAT_SERVICE_PORT**: Порт, на котором работает сервис ChatService.
- **CLIENT_PORT**: Порт, на котором работает клиентское приложение.
- **DB_PORT**: Порт для подключения к базе данных PostgreSQL.
- **POSTGRES_DB**: Имя базы данных для сервиса.
- **POSTGRES_USER**: Имя пользователя для подключения к базе данных.
- **POSTGRES_PASSWORD**: Пароль для подключения к базе данных.

Эти параметры будут использоваться при запуске и настройке подключения к базе данных.

## Конфигурация сервиса через `appsettings.json`

Файл `appsettings.json` находится в проекте `ChatService` и содержит основные настройки конфигурации:

```json
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "AllowedHosts": "*",
  "DatabaseSettings": {
    "DefaultConnection": "Host=localhost;Port=5432;Username=user;Password=password;Database=chatservice"
  },
  "Swagger": {
    "Endpoint": "/swagger/v1/swagger.json",
    "Title": "Chat Service API",
    "Version": "v1"
  },
  "Cors": {
    "AllowedOrigin": "http://localhost:5068"
  }
}
```

- **Logging**: Конфигурация уровня логирования.
- **DatabaseSettings**: Настройки подключения к базе данных.
- **Swagger**: Конфигурация Swagger UI.
- **Cors**: Настройки CORS.

## Разработка и тестирование

Для разработки и тестирования используйте стандартные инструменты .NET и библиотеки, такие как xUnit для тестирования и Moq для создания заглушек.